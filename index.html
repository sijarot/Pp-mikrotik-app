<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PPP MikroTik Manager</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    input, button { margin: 5px; padding: 5px; }
  </style>
</head>
<body>

<h2>Login MikroTik REST API</h2>
<input type="text" id="ip" placeholder="IP MikroTik">
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button id="loadBtn">Muat Data</button>

<h3>Tambah PPP Secret</h3>
<input type="text" id="newUser" placeholder="Nama user">
<input type="text" id="newPass" placeholder="Password">
<button id="addBtn">Tambah</button>

<h3>PPP Secret</h3>
<table id="secretTable"><thead><tr><th>Name</th><th>Password</th><th>Service</th><th>ID</th><th>Aksi</th></tr></thead><tbody></tbody></table>

<h3>PPP Active</h3>
<table id="activeTable"><thead><tr><th>Name</th><th>Address</th></tr></thead><tbody></tbody></table>

<h3>Interface</h3>
<table id="interfaceTable"><thead><tr><th>Name</th><th>Type</th></tr></thead><tbody></tbody></table>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx00mqX2pt0DsAtY_waGfXlKXLBX2tevOKCyCWb5RUfkkDiHGUxH_Ib84IGu422MxhNXw/exec";

  function getAuthData() {
    return {
      ip: $('#ip').val(),
      username: $('#username').val(),
      password: $('#password').val()
    };
  }

  function loadData() {
    const data = { ...getAuthData(), action: "read" };
    $.post(SCRIPT_URL, JSON.stringify(data), function(res) {
      // PPP SECRET
      const secretBody = $('#secretTable tbody');
      secretBody.empty();
      res.secret.forEach(item => {
        secretBody.append(`<tr>
          <td>${item.name}</td>
          <td>${item.password || '-'}</td>
          <td>${item.service}</td>
          <td>${item[".id"]}</td>
          <td><button onclick="deleteSecret('${item[".id"]}')">Hapus</button></td>
        </tr>`);
      });

      // PPP ACTIVE
      const activeBody = $('#activeTable tbody');
      activeBody.empty();
      res.active.forEach(item => {
        activeBody.append(<tr><td>${item.name}</td><td>${item.address}</td></tr>);
      });

      // INTERFACE
      const interfaceBody = $('#interfaceTable tbody');
      interfaceBody.empty();
      res.interface.forEach(item => {
        interfaceBody.append(<tr><td>${item.name}</td><td>${item.type}</td></tr>);
      });
    }, 'json');
  }

  function addSecret() {
    const data = {
      ...getAuthData(),
      action: "add",
      new_user: $('#newUser').val(),
      new_pass: $('#newPass').val()
    };
    $.post(SCRIPT_URL, JSON.stringify(data), function(res) {
      alert("User berhasil ditambahkan!");
      loadData();
    });
  }

  function deleteSecret(id) {
    const data = { ...getAuthData(), action: "delete", id: id };
    if (confirm("Hapus user ini?")) {
      $.post(SCRIPT_URL, JSON.stringify(data), function(res) {
        alert("User dihapus!");
        loadData();
      });
    }
  }

  $('#loadBtn').click(loadData);
  $('#addBtn').click(addSecret);
</script>

</body>
</html>